<ng-container *ngIf="dataFromStore$ | async as dataFromStore">
    <mat-card appearance="outlined" class="p-3 h-100">
        <ng-container *ngIf="chatroom; else noChosenRoom">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="lead text-bold">{{chatroom.name}}</span>
                <div>
                    <button class="btn btn-sm bg-brown text-beige me-2">
                        <mat-icon fontIcon="edit"></mat-icon>
                    </button>
                    <button class="btn btn-sm bg-red text-beige">
                        <mat-icon fontIcon="exit_to_app"></mat-icon>
                    </button>
                </div>
            </div>
            <div class="d-flex align-items-center mb-2" *ngIf="chatroom.description">
                <mat-icon fontIcon="description" class="me-2"></mat-icon>
                <span>{{chatroom.description}}</span>
            </div>
            <div class="d-flex align-items-center mb-2">
                <mat-icon fontIcon="people" class="me-2"></mat-icon>
                <app-user-viewer [readonly]="true" [users]="dataFromStore.roomMembers"></app-user-viewer>
            </div>
            <hr>

            <ng-container *ngIf="dataFromStore.messages.length > 0; else noMessages">
                <div #messages class="messages">
                    <span *ngFor="let message of dataFromStore.messages">
                        <app-message-display [message]="message" [isOwnMessage]="dataFromStore.loggedInUser.id === message.user.id"></app-message-display>
                    </span>
                </div>
            </ng-container>

            <ng-template #noMessages>
                <img src="assets/empty-chat.png" alt="Nema poruka" class="img-fluid">
                <p class="lead text-center mb-5">Nema poruka</p>
            </ng-template>

            <form [formGroup]="newMessageForm" (ngSubmit)="sendMessage()">
                <div class="d-flex gap-2 align-items-end mt-3">
                    <mat-form-field appearance="fill" class="w-100" subscriptSizing="dynamic">
                        <textarea matInput placeholder="Poruka" formControlName="text" rows="1" class="message-input" (input)="changeTextareaHeight($event)"></textarea>
                    </mat-form-field>
                    <button class="btn bg-purple text-beige send-btn" [disabled]="newMessageForm.invalid" type="submit">
                        <mat-icon fontIcon="send"></mat-icon>
                    </button>
                </div>
            </form>

        </ng-container>

        <ng-template #noChosenRoom>
            <p class="lead text-center">Izaberite chat</p>
            <div class="d-flex align-items-center h-100">
                <img src="assets/no-chat-selected.png" class="img-fluid" alt="Nije izabran chat">
            </div>
        </ng-template>
    </mat-card>
</ng-container>